upstream cgi-handler {
    server unix:/run/shibboleth/dip-display.sock;
}

server {

  listen 8089 ssl http2;
  server_name {PUBLICIP};

  root /var/archivematica/sharedDirectory/www;
  ssl_certificate     /etc/nginx/conf.d/host.crt;
  ssl_certificate_key /etc/nginx/conf.d/host.key;
  ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers         HIGH:!aNULL:!MD5;

  ssl_session_cache     shared:SSL:20m;
  ssl_session_timeout   4h;

  # Adjust to taste
  client_max_body_size 256M;

  location / {

    # Restrict DIP backdoor to specific systems
    #allow 192.168.1.255;
    #deny  all;

    fastcgi_param HTTPS on;
    include       fastcgi_params;
    fastcgi_intercept_errors on;
    fastcgi_param PATH_INFO       $fastcgi_path_info;
    fastcgi_pass  cgi-handler;
    }
}
