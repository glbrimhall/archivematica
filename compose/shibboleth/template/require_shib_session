  include shib_clear_headers;
  shib_request /shibauthorizer;

  # This next shib_request_use_headers should not be necessary, but it is for now.
  shib_request_use_headers on;
  include shib_fastcgi_params;

  # Only attribute from testshib.org really useable is EPPN
  shib_request_set $shib_eppn $upstream_http_variable_eppn;
  shib_request_set $shib_eppn $upstream_http_variable_sn;
  shib_request_set $shib_eppn $upstream_http_variable_mail;
  shib_request_set $shib_eppn $upstream_http_variable_givenname;
  fastcgi_param EPPN $shib_eppn;
  fastcgi_param SN $shib_eppn;
  fastcgi_param MAIL $shib_eppn;
  fastcgi_param GIVENNAME $shib_eppn;
  fastcgi_param HTTP_SN $shib_eppn;
  fastcgi_param HTTP_MAIL $shib_eppn;
  fastcgi_param HTTP_GIVENNAME $shib_eppn;

  # Enable to spoof or quickly test filesender with shibboleth authentication
  #fastcgi_param HTTP_SHIB_CN 'Test User';
  #fastcgi_param HTTP_SHIB_UID 'test_username';
  #fastcgi_param HTTP_SHIB_MAIL 'test_user@abcde.edu';
